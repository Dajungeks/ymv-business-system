# YMV ERP í†µí•© í˜„ê¸ˆ íë¦„ ê´€ë¦¬ ì‹œìŠ¤í…œ ìš”ì•½

## í•µì‹¬ ì¶”ê°€ ë‚´ìš©

### 1. í†µí•© í˜„ê¸ˆ íë¦„ ê³„ì‚°

#### ìˆ˜ì…ì› (ì˜ì—… í”„ë¡œì„¸ìŠ¤)
- ê²¬ì ì„œ ìŠ¹ì¸ëœ ì˜ì—… í”„ë¡œì„¸ìŠ¤
- ì˜ˆìƒ ë°°ì†¡ì¼ ê¸°ì¤€ ì›”ë³„ ìˆ˜ì… ì˜ˆì¸¡

#### ì§€ì¶œì› (ì§€ì¶œìš”ì²­ì„œ)
- ìŠ¹ì¸ëœ/ëŒ€ê¸°ì¤‘ì¸ ì§€ì¶œìš”ì²­ì„œ
- ì§€ì¶œ ì˜ˆì •ì¼ ê¸°ì¤€ ì›”ë³„ ì§€ì¶œ ì˜ˆì¸¡

### 2. ì‹¤ì‹œê°„ ì¬ë¬´ ìƒíƒœ ëª¨ë‹ˆí„°ë§

```python
get_current_financial_status()
- íŒŒì´í”„ë¼ì¸ ì´ ê°€ì¹˜ (ì˜ˆìƒ ìˆ˜ì…)
- ìŠ¹ì¸ëœ ì§€ì¶œ ì´ì•¡
- ìˆœ í˜„ê¸ˆ íë¦„ ì „ë§ (ìˆ˜ì… - ì§€ì¶œ)
- ì¬ë¬´ ê±´ì „ì„± ì§€í‘œ
```

### 3. í†µí•© ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

- **ì „ì²´ ì¬ë¬´ ìƒíƒœ**: 4ê°œ í•µì‹¬ ì§€í‘œ ì¹´ë“œ
- **ì›”ë³„ í˜„ê¸ˆ íë¦„ ì°¨íŠ¸**: ìˆ˜ì…/ì§€ì¶œ/ìˆœíë¦„ ì‹œê°í™”
- **ì›”ë³„ ìƒì„¸ ë‚´ì—­**: ìˆ˜ì…/ì§€ì¶œ í•­ëª©ë³„ ì„¸ë¶€ ì •ë³´
- **í˜„ê¸ˆ íë¦„ ê²½ê³ **: ì ì ì˜ˆìƒ ì›”, ëŒ€ê·œëª¨ ì§€ì¶œ ì•Œë¦¼

### 4. ì‹¤ì œ ì—…ë¬´ ì‹œë‚˜ë¦¬ì˜¤

```
ê²¬ì ì„œ ìŠ¹ì¸ â†’ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒì„± â†’ ì˜ˆìƒ ìˆ˜ì… ë“±ë¡
    â†“
ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ â†’ ì˜ˆìƒ ì§€ì¶œ ë“±ë¡
    â†“
ì›”ë³„ í†µí•© í˜„ê¸ˆ íë¦„ = ì˜ˆìƒ ìˆ˜ì… - ì˜ˆìƒ ì§€ì¶œ
    â†“
ìˆœ í˜„ê¸ˆ íë¦„ ê¸°ë°˜ ê²½ì˜ ì˜ì‚¬ê²°ì •
```

### 5. í•µì‹¬ ê°œì„ ì 

- **ì‹¤ì‹œê°„ ìˆœ í˜„ê¸ˆíë¦„**: í‘ì/ì ì ì¦‰ì‹œ íŒŒì•…
- **ì›”ë³„ ìƒì„¸ ë¶„ì„**: ìˆ˜ì…/ì§€ì¶œ í•­ëª©ë³„ ì¶”ì 
- **ê²½ê³  ì‹œìŠ¤í…œ**: ì ì ì˜ˆìƒ ì›” ì‚¬ì „ ì•Œë¦¼
- **ë¶€ì„œë³„ ì§€ì¶œ ì¶”ì **: ì§€ì¶œìš”ì²­ì„œ ë¶€ì„œë³„ ì§‘ê³„

## ì‹œìŠ¤í…œ íŠ¹ì§•

### í†µí•©ì„±
- ì˜ì—… ìˆ˜ì…ê³¼ ì´ë¬´ ì§€ì¶œì„ í•˜ë‚˜ì˜ í˜„ê¸ˆ íë¦„ìœ¼ë¡œ í†µí•© ê´€ë¦¬
- ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™ìœ¼ë¡œ ì¦‰ì‹œ ë°˜ì˜

### ì˜ˆì¸¡ì„±
- ê²¬ì ì„œ ìŠ¹ì¸ ì¦‰ì‹œ ë¯¸ë˜ ìˆ˜ì… ì˜ˆì¸¡ ì‹œì‘
- ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ìœ¼ë¡œ ë¯¸ë˜ ì§€ì¶œ ì˜ˆì¸¡
- ìµœëŒ€ 6ê°œì›” ì „ í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ ê°€ëŠ¥

### ì˜ì‚¬ê²°ì • ì§€ì›
- ì›”ë³„ ìˆœ í˜„ê¸ˆíë¦„ìœ¼ë¡œ í‘ì/ì ì ì‚¬ì „ íŒŒì•…
- ì ì ì˜ˆìƒ ì‹œ ì¡°ê¸° ê²½ê³  ì‹œìŠ¤í…œ
- ë¶€ì„œë³„ ì§€ì¶œ íŒ¨í„´ ë¶„ì„

### ì‹œê°í™”
- ì§ê´€ì ì¸ ì°¨íŠ¸ì™€ ê·¸ë˜í”„
- ìƒ‰ìƒ ì½”ë”©ìœ¼ë¡œ ìœ„í—˜ ìƒí™© ì¦‰ì‹œ ì¸ì‹
- ë“œë¦´ë‹¤ìš´ ê°€ëŠ¥í•œ ìƒì„¸ ì •ë³´

## í™œìš© íš¨ê³¼

### ê²½ì˜ì§„
- íšŒì‚¬ ì „ì²´ í˜„ê¸ˆ íë¦„ í•œëˆˆì— íŒŒì•…
- íˆ¬ì ë° ì§€ì¶œ ì˜ì‚¬ê²°ì • ê·¼ê±° ì œê³µ
- ë¦¬ìŠ¤í¬ ê´€ë¦¬ ë° ì˜ˆë°©

### ì˜ì—…íŒ€
- ê²¬ì ì„œ ìŠ¹ì¸ì´ í˜„ê¸ˆ íë¦„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ì¦‰ì‹œ í™•ì¸
- ì˜ì—… ì„±ê³¼ì˜ ì¬ë¬´ì  ì„íŒ©íŠ¸ ì¸¡ì •

### ì´ë¬´íŒ€
- ì§€ì¶œ ê³„íšì´ ì „ì²´ í˜„ê¸ˆ íë¦„ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„
- ì ì ˆí•œ ì§€ì¶œ íƒ€ì´ë° ê²°ì •

### ì¬ë¬´íŒ€
- í†µí•© ì¬ë¬´ í˜„í™© ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- ì˜ˆì‚° ëŒ€ë¹„ ì‹¤ì  ì¶”ì 
- í˜„ê¸ˆ ê´€ë¦¬ ìµœì í™”
# YMV ERP ì‹œìŠ¤í…œ ì™„ì „ ê°œë°œ ê°€ì´ë“œ - Supabase ê¸°ë°˜ v3.0 Final

## ğŸ¯ í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´

### ì‹œìŠ¤í…œ ê°œìš”
- **í”„ë¡œì íŠ¸ëª…**: YMV ê´€ë¦¬ í”„ë¡œê·¸ë¨ (ERP ì‹œìŠ¤í…œ)
- **ê°œë°œ ì–¸ì–´**: Python + Streamlit
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase (PostgreSQL)
- **ì•„í‚¤í…ì²˜**: ì»´í¬ë„ŒíŠ¸ ê¸°ë°˜ ëª¨ë“ˆí™”
- **í˜„ì¬ ì§„í–‰ë¥ **: 95% ì™„ì„±

### Supabase ì—°ê²° ì •ë³´
```
SUPABASE_URL = "https://eqplgrbegwzeynnbcuep.supabase.co"
SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
í”„ë¡œì íŠ¸ ìœ„ì¹˜: D:\ymv-business-system
GitHub: https://github.com/dajungeks/ymv-business-system.git
```

---

## ğŸ“ í•µì‹¬ ê°œë°œ ì›ì¹™ (ì ˆëŒ€ ì¤€ìˆ˜)

### 1. DB ìš°ì„  ì›ì¹™ â­â­â­
```
âŒ ì¶”ì¸¡ì„± ì½”ë”© ì ˆëŒ€ ê¸ˆì§€
âœ… ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆ í™•ì¸ í›„ ì½”ë”©
âœ… ì»¬ëŸ¼ëª…/íƒ€ì… ì •í™•íˆ ë§¤í•‘ í›„ ê°œë°œ
âœ… ì•„ë˜ í™•ì •ëœ ìŠ¤í‚¤ë§ˆ ì •ë³´ ê¸°ì¤€ìœ¼ë¡œë§Œ ê°œë°œ
```

### 2. ê°œë°œ ê·œì¹™ V10 ì¤€ìˆ˜
```
- í•­ìƒ ì „ì²´ íŒŒì¼ ë‹¨ìœ„ ì½”ë“œ ì œê³µ
- ìˆ˜ì • ì „ ì„¤ëª… â†’ ìŠ¹ì¸ â†’ ì½”ë”©
- Step ë‹¨ìœ„ ì§„í–‰
- 1ê°€ì§€ ìµœì  ë°©ë²•ë§Œ ì œì‹œ
- ì¶”ì¸¡ ê¸ˆì§€, DB/ì½”ë“œ ìš”ì²­ í›„ í™•ì¸
```

### 3. Supabase ì „ìš© ì•„í‚¤í…ì²˜
```
- ConnectionWrapper í´ë˜ìŠ¤ ì‚¬ìš© í•„ìˆ˜
- ì§ì ‘ DB ì—°ê²° í˜¸ì¶œ ê¸ˆì§€
- utils/database.py í†µí•œ DB ì‘ì—…
- ëª¨ë“  ì˜ˆì™¸ ì²˜ë¦¬ ë° ë¡œê¹…
```

---

## ğŸ—„ï¸ í™•ì •ëœ DB ìŠ¤í‚¤ë§ˆ (Supabase ì‹¤ì œ)

### 1. products í…Œì´ë¸” (ì œí’ˆ ê´€ë¦¬)
```sql
-- í•µì‹¬ ì»¬ëŸ¼ë“¤
id                  integer (PK, auto)
product_code        varchar(50) NOT NULL
product_name        varchar(200) NOT NULL
product_name_en     varchar(200)
product_name_vn     varchar(200) 
product_name_kr     varchar(200)
category            varchar(50) NOT NULL
unit                varchar(20) DEFAULT 'ê°œ'

-- ê°€ê²© ì •ë³´ (ì •í™•í•œ ì»¬ëŸ¼ëª…)
unit_price          numeric DEFAULT 0          -- ê¸°ë³¸ ë‹¨ê°€
unit_price_vnd      numeric DEFAULT 0          -- VND ë‹¨ê°€
cost_price_usd      numeric DEFAULT 0          -- âœ… USD ì›ê°€
cost_price_cny      numeric DEFAULT 0          -- CNY ì›ê°€  
selling_price_usd   numeric DEFAULT 0          -- âœ… USD íŒë§¤ê°€

-- ê¸°íƒ€ ì •ë³´
currency            varchar(3) DEFAULT 'USD'
supplier            varchar(200)
stock_quantity      integer DEFAULT 0
description         text
specifications      text
weight_kg           numeric
dimensions          varchar(100)
material            varchar(100)
lead_time_days      integer DEFAULT 30
minimum_order_qty   integer DEFAULT 1
is_active           boolean DEFAULT true
notes               text
created_at          timestamptz DEFAULT now()
updated_at          timestamptz DEFAULT now()
```

### 2. quotations í…Œì´ë¸” (ê²¬ì ì„œ ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id                  integer (PK, auto)
quote_number        varchar(30)
revision_number     varchar(10) DEFAULT 'Rv01'
quote_date          date NOT NULL
valid_until         date NOT NULL
currency            varchar(3) DEFAULT 'USD'
status              varchar(20) DEFAULT 'ì‘ì„±ì¤‘'

-- ê³ ê° ì •ë³´
customer_id         integer (FK to customers)
customer_name       varchar(100) NOT NULL
company             varchar(200) NOT NULL
contact_person      varchar(100)
email               varchar(100)
phone               varchar(20)
customer_address    text

-- ì œí’ˆ/ê²¬ì  ì •ë³´
item_code           varchar(50)
item_name           varchar(200) NOT NULL
item_name_en        varchar(200)
item_name_vn        varchar(200)
quantity            integer NOT NULL
unit_price          numeric NOT NULL        -- ê²¬ì  ë‹¨ê°€
std_price           numeric                 -- í‘œì¤€ê°€
discount_rate       numeric DEFAULT 0.00    -- í• ì¸ìœ¨
total_amount        numeric                 -- ì´ì•¡

-- í”„ë¡œì íŠ¸ ì •ë³´
project_name        varchar(200)
part_name           varchar(200)
mold_no             varchar(100)
part_weight         numeric
hrs_info            varchar(200)
resin_type          varchar(100)
resin_additive      varchar(200)
sol_material        varchar(200)

-- ê±°ë˜ ì¡°ê±´
payment_terms       varchar(200)
delivery_date       date
vat_rate            numeric DEFAULT 10.00
remark              text
notes               text

-- ì‹œìŠ¤í…œ ì •ë³´
sales_rep_id        integer (FK to employees)
created_by          integer (FK to employees)
created_at          timestamptz DEFAULT now()
updated_at          timestamptz DEFAULT now()
```

**âš ï¸ ì¤‘ìš”: quotations í…Œì´ë¸”ì—ëŠ” ì›ê°€ ì»¬ëŸ¼ì´ ì—†ìŒ!**
ê²¬ì ì„œì—ì„œ ì›ê°€ ì •ë³´ê°€ í•„ìš”í•  ë•ŒëŠ” products í…Œì´ë¸”ì˜ `cost_price_usd`ë¥¼ ì¡°íšŒí•´ì•¼ í•¨.

### 3. customers í…Œì´ë¸” (ê³ ê° ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id                   integer (PK, auto)
company_name         varchar(200) NOT NULL
contact_person       varchar(100) NOT NULL
position             varchar(100)
phone                varchar(20)
email                varchar(100)
mobile               varchar(50)
address              text

-- ì‚¬ì—…ì ì •ë³´
business_type        varchar(100)
business_number      varchar(50)
country              varchar(100)
tax_id               varchar(100)
payment_terms        varchar(100)

-- KAM ì •ë³´
assigned_employee_id integer (FK to employees)
kam_name             varchar(255)
kam_phone            varchar(50)
kam_position         varchar(100)
kam_notes            text

-- ìƒíƒœ ê´€ë¦¬
status               varchar(50) DEFAULT 'Active'
notes                text
created_at           timestamptz DEFAULT now()
updated_at           timestamptz DEFAULT now()
```

### 4. employees í…Œì´ë¸” (ì§ì› ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id                integer (PK, auto)
name              varchar(100) NOT NULL
username          varchar(50) NOT NULL
password          varchar(255) NOT NULL
employee_id       varchar(20)

-- ì¡°ì§ ì •ë³´
department        varchar(50) NOT NULL
position          varchar(100)
manager_id        integer (FK to employees)
role              varchar(20) DEFAULT 'employee'

-- ì—°ë½ì²˜
email             varchar(100)
phone             varchar(20)
address           text
emergency_contact varchar(100)
emergency_phone   varchar(20)

-- ê·¼ë¬´ ì •ë³´
hire_date         date
salary            numeric
employment_status varchar(20) DEFAULT 'active'
work_type         varchar(20) DEFAULT 'full_time'
birth_date        date

-- ê¶Œí•œ
is_admin          boolean DEFAULT false
is_active         boolean DEFAULT true

-- ë©”íƒ€
notes             text
created_at        timestamptz DEFAULT now()
updated_at        timestamptz DEFAULT now()
```

### 5. expenses í…Œì´ë¸” (ì§€ì¶œ ìš”ì²­ì„œ)
```sql
-- ê¸°ë³¸ ì •ë³´
id               integer (PK, auto)
expense_type     varchar(50) NOT NULL
amount           numeric NOT NULL
currency         varchar(3) DEFAULT 'USD'
payment_method   varchar(50) NOT NULL
expense_date     date NOT NULL

-- ìš”ì²­ ì •ë³´
department       varchar(50)
requester        integer (FK to employees)
urgency          varchar(20) DEFAULT 'ë³´í†µ'
description      text NOT NULL
business_purpose text
purpose          text
vendor           varchar(200)

-- ìƒíƒœ ê´€ë¦¬
status           varchar(20) DEFAULT 'ëŒ€ê¸°ì¤‘'
created_at       timestamptz DEFAULT now()
updated_at       timestamptz DEFAULT now()
```

### 6. purchases í…Œì´ë¸” (êµ¬ë§¤í’ˆ ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id           integer (PK, auto)
category     varchar(50) NOT NULL
item_name    varchar(200) NOT NULL
quantity     integer NOT NULL
unit         varchar(20) DEFAULT 'ê°œ'

-- ê°€ê²© ì •ë³´
unit_price   numeric NOT NULL
total_price  numeric
currency     varchar(3) DEFAULT 'KRW'

-- ê³µê¸‰ì—…ì²´
supplier     varchar(200)

-- ìš”ì²­ ì •ë³´
request_date date NOT NULL
urgency      varchar(20) DEFAULT 'ë³´í†µ'
status       varchar(20) DEFAULT 'ëŒ€ê¸°ì¤‘'
requester    integer (FK to employees)
notes        text

-- ë©”íƒ€
created_at   timestamptz DEFAULT now()
updated_at   timestamptz DEFAULT now()
```

### 7. suppliers í…Œì´ë¸” (ê³µê¸‰ì—…ì²´ ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id             integer (PK, auto)
name           varchar(200) NOT NULL
company_name   varchar(200) NOT NULL
contact_person varchar(100)
email          varchar(100)
phone          varchar(50)
address        text

-- ì‚¬ì—… ì •ë³´
business_type  varchar(100)
payment_terms  varchar(100)
delivery_terms varchar(100)
rating         integer DEFAULT 5

-- ìƒíƒœ ê´€ë¦¬
is_active      boolean DEFAULT true
notes          text
created_at     timestamptz DEFAULT now()
updated_at     timestamptz DEFAULT now()
```

### 8. exchange_rates í…Œì´ë¸” (í™˜ìœ¨ ê´€ë¦¬)
```sql
-- ê¸°ë³¸ ì •ë³´
id             integer (PK, auto)
from_currency  varchar(3) NOT NULL
to_currency    varchar(3) NOT NULL
rate           numeric NOT NULL
effective_date date NOT NULL

-- ë©”íƒ€
notes          text
created_by     integer (FK to employees)
created_at     timestamptz DEFAULT now()
updated_at     timestamptz DEFAULT now()
```

### 9. company_info í…Œì´ë¸” (íšŒì‚¬ ì •ë³´)
```sql
-- ê¸°ë³¸ ì •ë³´
id              integer (PK, auto)
company_name    varchar(200) NOT NULL
address         text
phone           varchar(20)
email           varchar(100)

-- ì‚¬ì—…ì ì •ë³´
business_number varchar(50)
tax_number      varchar(50)
ceo_name        varchar(100)
business_type   varchar(100)

-- ë©”íƒ€
notes           text
created_at      timestamptz DEFAULT now()
updated_at      timestamptz DEFAULT now()
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### main.py êµ¬ì¡° (í™•ì •)
```python
# Import ìˆœì„œ (ê·œì¹™ 15)
# 1. í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
import streamlit as st
import time

# 2. ì„œë“œíŒŒí‹°
import supabase
from supabase import create_client, Client

# 3. ë‚´ë¶€ ëª¨ë“ˆ
from components.quotation_management import show_quotation_management
from components.customer_management import show_customer_management  
from components.product_management import show_product_management
from utils.database import create_database_operations
```

### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```
app/
â”œâ”€â”€ main.py                          # ë¼ìš°íŒ…ë§Œ
â”œâ”€â”€ components/                      # ê¸°ëŠ¥ë³„ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ quotation_management.py     # ê²¬ì ì„œ ê´€ë¦¬
â”‚   â”œâ”€â”€ customer_management.py      # ê³ ê° ê´€ë¦¬
â”‚   â”œâ”€â”€ product_management.py       # ì œí’ˆ ê´€ë¦¬
â”‚   â”œâ”€â”€ expense_management.py       # ì§€ì¶œ ê´€ë¦¬
â”‚   â”œâ”€â”€ employee_management.py      # ì§ì› ê´€ë¦¬
â”‚   â””â”€â”€ supplier_management.py      # ê³µê¸‰ì—…ì²´ ê´€ë¦¬
â””â”€â”€ utils/                          # ê³µí†µ ìœ í‹¸ë¦¬í‹°
    â”œâ”€â”€ database.py                 # DB ì—°ê²° ê´€ë¦¬
    â”œâ”€â”€ auth.py                     # ì¸ì¦ ê´€ë¦¬
    â””â”€â”€ helpers.py                  # ê³µí†µ í•¨ìˆ˜ë“¤
```

---

## ğŸ”§ í•µì‹¬ ê°œë°œ íŒ¨í„´

### 1. DB ì—°ê²° íŒ¨í„´ (ConnectionWrapper í•„ìˆ˜)
```python
# utils/database.py
class ConnectionWrapper:
    def __init__(self, supabase_client):
        self.client = supabase_client
    
    def execute_query(self, operation, table, data=None, filters=None):
        """ëª¨ë“  DB ì‘ì—…ì˜ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤"""
        try:
            if operation == "select":
                query = self.client.table(table).select("*")
                if filters:
                    for key, value in filters.items():
                        query = query.eq(key, value)
                return query.execute()
            
            elif operation == "insert":
                return self.client.table(table).insert(data).execute()
            
            elif operation == "update":
                if 'id' not in data:
                    raise ValueError("Update ì‹œ ID í•„ìˆ˜")
                update_data = {k: v for k, v in data.items() if k != 'id'}
                return self.client.table(table).update(update_data).eq('id', data['id']).execute()
            
            elif operation == "delete":
                return self.client.table(table).delete().eq('id', filters['id']).execute()
                
        except Exception as e:
            # ë¡œê¹… í›„ ì¬ì „ë‹¬
            print(f"DB Error: {str(e)}")
            raise e

# ì‚¬ìš© íŒ¨í„´
db_operations = create_database_operations(supabase_client)
```

### 2. ì»´í¬ë„ŒíŠ¸ í•¨ìˆ˜ í˜¸ì¶œ íŒ¨í„´
```python
# ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” ë™ì¼í•œ ì‹œê·¸ë‹ˆì²˜
def show_component_management(load_func, save_func, update_func, delete_func):
    """í‘œì¤€ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°"""
    
    # main.pyì—ì„œ í˜¸ì¶œ
    show_product_management(
        load_func=db_operations.load_data,
        save_func=db_operations.save_data,
        update_func=db_operations.update_data,
        delete_func=db_operations.delete_data
    )
```

### 3. ì œí’ˆ-ê²¬ì ì„œ ì›ê°€ ì—°ë™ íŒ¨í„´ (ì¤‘ìš”!)
```python
# ê²¬ì ì„œì—ì„œ ì œí’ˆ ì›ê°€ ì¡°íšŒ ì‹œ
def get_product_cost_price(product_id, load_func):
    """ì œí’ˆ ì›ê°€ ì¡°íšŒ - ì •í™•í•œ ì»¬ëŸ¼ëª… ì‚¬ìš©"""
    products = load_func("products")
    product = next((p for p in products if p['id'] == product_id), None)
    
    if product:
        # âœ… ì •í™•í•œ ì»¬ëŸ¼ëª… ì‚¬ìš©
        return product.get('cost_price_usd', 0)  # cost_priceê°€ ì•„ë‹˜!
    return 0

# ê²¬ì ì„œ ë§ˆì§„ ê³„ì‚°
def calculate_margin(selling_price, cost_price_usd):
    """ë§ˆì§„ ê³„ì‚°"""
    if cost_price_usd > 0:
        margin = ((selling_price - cost_price_usd) / selling_price) * 100
        return round(margin, 2)
    return 0
```

### 4. ë°ì´í„° ì—…ë°ì´íŠ¸ íŒ¨í„´
```python
# ì œí’ˆ ìˆ˜ì • ì‹œ (ID í¬í•¨ í•„ìˆ˜)
def update_product(product_data, update_func):
    """ì œí’ˆ ìˆ˜ì • - ID í¬í•¨ ë°©ì‹"""
    update_data = {
        'id': product_data['id'],  # ID í¬í•¨ í•„ìˆ˜
        'product_name': product_data['product_name'],
        'cost_price_usd': product_data['cost_price_usd'],
        # ... ê¸°íƒ€ í•„ë“œë“¤
    }
    
    return update_func('products', update_data)
```

### 10. sales_process í…Œì´ë¸” (ì˜ì—… í”„ë¡œì„¸ìŠ¤ ë©”ì¸)
```sql
-- ê¸°ë³¸ ì •ë³´
id                     integer (PK, auto)
process_number         varchar(20) NOT NULL        -- ì˜ì—…ë²ˆí˜¸
quotation_id           integer (FK to quotations)  -- ê²¬ì ì„œ ì—°ê²°
order_id               integer (FK to orders)      -- ì£¼ë¬¸ì„œ ì—°ê²°

-- ê³ ê° ì •ë³´ (ì¤‘ë³µ ì €ì¥)
customer_name          varchar(255) NOT NULL
customer_company       varchar(255) NOT NULL
customer_email         varchar(255)
customer_phone         varchar(20)

-- ì˜ì—… ë‹´ë‹¹ì
sales_rep_id           integer (FK to employees) NOT NULL

-- í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
process_status         varchar(20) DEFAULT 'quotation'
-- ìƒíƒœê°’: quotation â†’ negotiation â†’ contract â†’ order â†’ delivery â†’ completed

-- ì œí’ˆ/ê²¬ì  ì •ë³´
item_description       text NOT NULL
quantity               integer NOT NULL
unit_price             numeric NOT NULL
total_amount           numeric NOT NULL
currency               varchar(3) DEFAULT 'VND'
profit_margin          numeric                     -- ë§ˆì§„ìœ¨

-- ì¼ì • ê´€ë¦¬
expected_delivery_date date
actual_delivery_date   date

-- ê±°ë˜ ì¡°ê±´
customer_po_number     varchar(50)                 -- ê³ ê° POë²ˆí˜¸
payment_terms          varchar(100)
delivery_terms         varchar(100)

-- ë©”íƒ€
notes                  text
created_at             timestamp DEFAULT now()
updated_at             timestamp DEFAULT now()
```

### 11. sales_process_history í…Œì´ë¸” (ì˜ì—… ì´ë ¥)
```sql
-- ê¸°ë³¸ ì •ë³´
id               integer (PK, auto)
sales_process_id integer (FK to sales_process) NOT NULL

-- ìƒíƒœ ë³€ê²½ ì¶”ì 
status_from      varchar(20)                    -- ì´ì „ ìƒíƒœ
status_to        varchar(20) NOT NULL           -- ë³€ê²½ëœ ìƒíƒœ
changed_by       integer (FK to employees) NOT NULL
change_date      timestamp DEFAULT now()

-- ë³€ê²½ ì‚¬ìœ 
change_reason    text
notes            text
```

### 12. orders í…Œì´ë¸” (ì£¼ë¬¸ì„œ)
```sql
-- ê¸°ë³¸ ì •ë³´
order_id         integer (PK, auto)
order_number     varchar(50) NOT NULL
quotation_id     integer (FK to quotations)
customer_id      integer (FK to customers)

-- ì¼ì •
order_date       date DEFAULT CURRENT_DATE
delivery_date    date

-- ìƒíƒœ ê´€ë¦¬
status           varchar(20) DEFAULT 'pending'
-- ìƒíƒœê°’: pending â†’ processing â†’ shipped â†’ delivered â†’ completed

-- ê¸ˆì•¡ ì •ë³´
subtotal         numeric DEFAULT 0
tax_amount       numeric DEFAULT 0
total_amount     numeric DEFAULT 0
currency         varchar(3) DEFAULT 'USD'

-- ë°°ì†¡ ì •ë³´
shipping_address text

-- ë©”íƒ€
notes            text
created_by       integer (FK to employees)
created_at       timestamptz DEFAULT CURRENT_TIMESTAMP
updated_at       timestamptz DEFAULT CURRENT_TIMESTAMP
```

---

## ğŸ”„ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì›Œí¬í”Œë¡œìš° (í˜„ê¸ˆ íë¦„ ê´€ë¦¬ ëª©ì )

### ì „ì²´ ì˜ì—… í”„ë¡œì„¸ìŠ¤ (3ë‹¨ê³„)
```
1. ê²¬ì ì„œ ê´€ë¦¬ ë‹¨ê³„ (quotations í…Œì´ë¸”)
   - ê²¬ì ì„œ ì‘ì„± â†’ ë°œì†¡ â†’ í˜‘ìƒ â†’ ìŠ¹ì¸/ê±°ì ˆ
   â†“ (ìŠ¹ì¸ ì¦‰ì‹œ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì‹œì‘)
2. ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì‹œì‘ (í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡)
   - ì£¼ë¬¸(order) â†’ ë°°ì†¡(delivery) â†’ ì™„ë£Œ(completed)
   â†“
3. ì£¼ë¬¸ì„œ ì²˜ë¦¬ (orders í…Œì´ë¸”)
   - ì£¼ë¬¸ ì ‘ìˆ˜ â†’ ì²˜ë¦¬ â†’ ë°°ì†¡ â†’ ì™„ë£Œ
```

### ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒíƒœê°’ (3ë‹¨ê³„ + í˜„ê¸ˆ íë¦„ ì •ë³´)
```
order      â†’ ì£¼ë¬¸ ì˜ˆì • (ì›”ë³„ ì˜ˆìƒ ìˆ˜ì… ê³„ì‚° ì‹œì‘)
delivery   â†’ ë°°ì†¡ ì¤‘ (ì§€ì¶œ ë°œìƒ: ë°°ì†¡ë¹„, ì œì¡°ë¹„ ë“±)
completed  â†’ ì™„ë£Œ (ì‹¤ì œ ìˆ˜ì… í™•ì •)
cancelled  â†’ ì·¨ì†Œ (ì–¸ì œë“  ê°€ëŠ¥)
```

### ìƒì„¸ í”„ë¡œì„¸ìŠ¤ íë¦„

#### 1ë‹¨ê³„: ê²¬ì ì„œ ìŠ¹ì¸ â†’ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì¦‰ì‹œ ì‹œì‘
```sql
-- ê²¬ì ì„œ ìŠ¹ì¸ í›„ â†’ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìë™ ìƒì„± (í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ìš©)
INSERT INTO sales_process (
    process_number,        -- SP240001 í˜•íƒœ
    quotation_id,          -- ìŠ¹ì¸ëœ ê²¬ì ì„œ ID
    customer_name,
    customer_company,
    sales_rep_id,
    process_status,        -- 'order' (ì£¼ë¬¸ ì˜ˆì • ìƒíƒœë¡œ ì‹œì‘)
    item_description,
    quantity,
    unit_price,
    total_amount,          -- ì˜ˆìƒ ìˆ˜ì…ì•¡
    currency,
    expected_delivery_date, -- ì˜ˆìƒ ìˆ˜ì… ì‹œê¸°
    profit_margin          -- ì˜ˆìƒ ë§ˆì§„
) VALUES (...)

-- í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ ì •ë³´ ì¶”ê°€
-- ì´ ì •ë³´ë¡œ ì›”ë³„ ì˜ˆìƒ ìˆ˜ì…/ì§€ì¶œ ê³„ì‚°
```

#### 2ë‹¨ê³„: í†µí•© í˜„ê¸ˆ íë¦„ ê´€ë¦¬ (ìˆ˜ì… + ì§€ì¶œ)
```python
def calculate_comprehensive_cash_flow(load_func):
    """ìˆ˜ì…(ì˜ì—… í”„ë¡œì„¸ìŠ¤) + ì§€ì¶œ(ì§€ì¶œìš”ì²­ì„œ) í†µí•© í˜„ê¸ˆ íë¦„ ê³„ì‚°"""
    
    # ì˜ì—… í”„ë¡œì„¸ìŠ¤ - ì˜ˆìƒ ìˆ˜ì…
    sales_processes = load_func("sales_process")
    # ì§€ì¶œìš”ì²­ì„œ - ì˜ˆìƒ ì§€ì¶œ
    expenses = load_func("expenses")
    
    monthly_cash_flow = {}
    
    # 1. ì˜ˆìƒ ìˆ˜ì… ê³„ì‚° (ì˜ì—… í”„ë¡œì„¸ìŠ¤)
    for process in sales_processes:
        if process.get('process_status') in ['order', 'delivery']:
            delivery_date = process.get('expected_delivery_date')
            if delivery_date:
                month_key = delivery_date[:7]  # YYYY-MM
                
                if month_key not in monthly_cash_flow:
                    monthly_cash_flow[month_key] = {
                        'expected_income': 0,
                        'expected_expenses': 0,
                        'net_cash_flow': 0,
                        'income_items': [],
                        'expense_items': []
                    }
                
                # ì˜ˆìƒ ìˆ˜ì… ëˆ„ì 
                amount = process.get('total_amount', 0)
                monthly_cash_flow[month_key]['expected_income'] += amount
                monthly_cash_flow[month_key]['income_items'].append({
                    'type': 'sales',
                    'description': process.get('item_description'),
                    'amount': amount,
                    'customer': process.get('customer_company'),
                    'process_number': process.get('process_number')
                })
    
    # 2. ì˜ˆìƒ ì§€ì¶œ ê³„ì‚° (ì§€ì¶œìš”ì²­ì„œ)
    for expense in expenses:
        if expense.get('status') in ['ëŒ€ê¸°ì¤‘', 'ìŠ¹ì¸ë¨']:  # ìŠ¹ì¸ëœ ì§€ì¶œë§Œ
            expense_date = expense.get('expense_date')
            if expense_date:
                month_key = expense_date[:7]  # YYYY-MM
                
                if month_key not in monthly_cash_flow:
                    monthly_cash_flow[month_key] = {
                        'expected_income': 0,
                        'expected_expenses': 0,
                        'net_cash_flow': 0,
                        'income_items': [],
                        'expense_items': []
                    }
                
                # ì˜ˆìƒ ì§€ì¶œ ëˆ„ì 
                amount = expense.get('amount', 0)
                monthly_cash_flow[month_key]['expected_expenses'] += amount
                monthly_cash_flow[month_key]['expense_items'].append({
                    'type': 'expense',
                    'description': expense.get('description'),
                    'amount': amount,
                    'expense_type': expense.get('expense_type'),
                    'department': expense.get('department'),
                    'urgency': expense.get('urgency')
                })
    
    # 3. ìˆœ í˜„ê¸ˆ íë¦„ ê³„ì‚°
    for month_key in monthly_cash_flow:
        income = monthly_cash_flow[month_key]['expected_income']
        expenses = monthly_cash_flow[month_key]['expected_expenses']
        monthly_cash_flow[month_key]['net_cash_flow'] = income - expenses
    
    return monthly_cash_flow

def get_current_financial_status(load_func):
    """í˜„ì¬ ì¬ë¬´ ìƒíƒœ ìš”ì•½"""
    
    # íŒŒì´í”„ë¼ì¸ ì´ ê°€ì¹˜ (ì˜ˆìƒ ìˆ˜ì…)
    pipeline_value = get_current_pipeline_value(load_func)
    
    # ìŠ¹ì¸ëœ ì§€ì¶œ ì´ì•¡
    expenses = load_func("expenses")
    approved_expenses = sum(
        e.get('amount', 0) for e in expenses 
        if e.get('status') in ['ìŠ¹ì¸ë¨', 'ëŒ€ê¸°ì¤‘']
    )
    
    # ìˆœ í˜„ê¸ˆ íë¦„ ì „ë§
    net_outlook = pipeline_value - approved_expenses
    
    return {
        'pipeline_value': pipeline_value,
        'approved_expenses': approved_expenses,
        'net_outlook': net_outlook,
        'cash_flow_health': 'positive' if net_outlook > 0 else 'negative'
    }
```

### í†µí•© í˜„ê¸ˆ íë¦„ ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥
```python
def render_comprehensive_cash_flow_dashboard(load_func):
    """ìˆ˜ì…/ì§€ì¶œ í†µí•© í˜„ê¸ˆ íë¦„ ëŒ€ì‹œë³´ë“œ"""
    
    # ì „ì²´ í˜„ê¸ˆ íë¦„ ê³„ì‚°
    cash_flow_data = calculate_comprehensive_cash_flow(load_func)
    financial_status = get_current_financial_status(load_func)
    
    st.subheader("ğŸ’° í†µí•© í˜„ê¸ˆ íë¦„ í˜„í™©")
    
    # 1. ì „ì²´ ì¬ë¬´ ìƒíƒœ
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric(
            "íŒŒì´í”„ë¼ì¸ ì´ ê°€ì¹˜", 
            f"{financial_status['pipeline_value']:,} VND",
            help="ì§„í–‰ ì¤‘ì¸ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì´ ê°€ì¹˜"
        )
    
    with col2:
        st.metric(
            "ìŠ¹ì¸ëœ ì§€ì¶œ ì´ì•¡", 
            f"{financial_status['approved_expenses']:,} VND",
            help="ìŠ¹ì¸ë˜ì—ˆê±°ë‚˜ ëŒ€ê¸° ì¤‘ì¸ ì§€ì¶œ ì´ì•¡"
        )
    
    with col3:
        net_value = financial_status['net_outlook']
        delta_color = "normal" if net_value >= 0 else "inverse"
        st.metric(
            "ìˆœ í˜„ê¸ˆ íë¦„ ì „ë§", 
            f"{net_value:,} VND",
            delta=f"{'í‘ì' if net_value >= 0 else 'ì ì'} ì˜ˆìƒ",
            delta_color=delta_color
        )
    
    with col4:
        active_processes = len([p for p in load_func("sales_process") 
                              if p.get('process_status') in ['order', 'delivery']])
        st.metric("ì§„í–‰ ì¤‘ì¸ ì˜ì—…", f"{active_processes}ê±´")
    
    # 2. ì›”ë³„ í˜„ê¸ˆ íë¦„ ì°¨íŠ¸
    if cash_flow_data:
        st.subheader("ğŸ“Š ì›”ë³„ í˜„ê¸ˆ íë¦„ ë¶„ì„")
        
        # ë°ì´í„° ì¤€ë¹„
        months = sorted(cash_flow_data.keys())
        income_data = [cash_flow_data[m]['expected_income'] for m in months]
        expense_data = [cash_flow_data[m]['expected_expenses'] for m in months]
        net_data = [cash_flow_data[m]['net_cash_flow'] for m in months]
        
        # ì°¨íŠ¸ ìƒì„± (Streamlitì˜ line_chart ì‚¬ìš©)
        import pandas as pd
        
        chart_data = pd.DataFrame({
            'ì›”': months,
            'ì˜ˆìƒ ìˆ˜ì…': income_data,
            'ì˜ˆìƒ ì§€ì¶œ': expense_data,
            'ìˆœ í˜„ê¸ˆíë¦„': net_data
        })
        
        st.line_chart(chart_data.set_index('ì›”'))
    
    # 3. ì›”ë³„ ìƒì„¸ ë‚´ì—­
    st.subheader("ğŸ“‹ ì›”ë³„ ìƒì„¸ í˜„ê¸ˆ íë¦„")
    
    for month in sorted(cash_flow_data.keys())[:6]:  # ìµœê·¼ 6ê°œì›”
        with st.expander(f"ğŸ“… {month} í˜„ê¸ˆ íë¦„ ìƒì„¸"):
            month_data = cash_flow_data[month]
            
            col1, col2 = st.columns(2)
            
            with col1:
                st.write("**ğŸ’° ì˜ˆìƒ ìˆ˜ì…**")
                for item in month_data['income_items']:
                    st.write(f"- {item['customer']}: {item['description']} ({item['amount']:,} VND)")
            
            with col2:
                st.write("**ğŸ’¸ ì˜ˆìƒ ì§€ì¶œ**")
                for item in month_data['expense_items']:
                    urgency_icon = "ğŸ”´" if item['urgency'] == 'ê¸´ê¸‰' else "ğŸŸ¡" if item['urgency'] == 'ë†’ìŒ' else "ğŸŸ¢"
                    st.write(f"- {urgency_icon} {item['expense_type']}: {item['description']} ({item['amount']:,} VND)")
            
            # ì›”ë³„ ìˆœ í˜„ê¸ˆíë¦„
            net_flow = month_data['net_cash_flow']
            if net_flow >= 0:
                st.success(f"ğŸ’° ìˆœ í˜„ê¸ˆíë¦„: +{net_flow:,} VND (í‘ì)")
            else:
                st.error(f"ğŸ’¸ ìˆœ í˜„ê¸ˆíë¦„: {net_flow:,} VND (ì ì)")

def get_cash_flow_alerts(load_func):
    """í˜„ê¸ˆ íë¦„ ê²½ê³  ì•Œë¦¼"""
    
    cash_flow_data = calculate_comprehensive_cash_flow(load_func)
    alerts = []
    
    for month, data in cash_flow_data.items():
        net_flow = data['net_cash_flow']
        
        # ì ì ê²½ê³ 
        if net_flow < 0:
            alerts.append({
                'type': 'warning',
                'month': month,
                'message': f"{month} ì ì ì˜ˆìƒ: {net_flow:,} VND",
                'recommendation': "ì§€ì¶œ ê³„íš ì¬ê²€í†  ë˜ëŠ” ìˆ˜ì… í™•ëŒ€ í•„ìš”"
            })
        
        # ëŒ€ê·œëª¨ ì§€ì¶œ ê²½ê³ 
        if data['expected_expenses'] > 1000000000:  # 10ì–µ VND ì´ìƒ
            alerts.append({
                'type': 'info',
                'month': month,
                'message': f"{month} ëŒ€ê·œëª¨ ì§€ì¶œ ì˜ˆì •: {data['expected_expenses']:,} VND",
                'recommendation': "í˜„ê¸ˆ ë³´ìœ ëŸ‰ í™•ì¸ í•„ìš”"
            })
    
    return alerts
```

### ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ ì‹œ í˜„ê¸ˆ íë¦„ ì—…ë°ì´íŠ¸
```python
def on_expense_approval(expense_id, approver_id, update_func, load_func):
    """ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ ì‹œ í˜„ê¸ˆ íë¦„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸"""
    
    # ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ ì²˜ë¦¬
    expense_update = {
        'id': expense_id,
        'status': 'ìŠ¹ì¸ë¨',
        'updated_at': datetime.now().isoformat()
    }
    update_func("expenses", expense_update)
    
    # í˜„ê¸ˆ íë¦„ ì˜í–¥ ê³„ì‚°
    expenses = load_func("expenses")
    expense = next((e for e in expenses if e['id'] == expense_id), None)
    
    if expense:
        expense_month = expense.get('expense_date', '')[:7]
        expense_amount = expense.get('amount', 0)
        
        return {
            'success': True,
            'message': f'ì§€ì¶œìš”ì²­ì„œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'cash_flow_impact': {
                'month': expense_month,
                'amount': expense_amount,
                'type': 'expense_increase'
            }
        }
    
    return {'success': False, 'message': 'ì§€ì¶œìš”ì²­ì„œ ìŠ¹ì¸ ì‹¤íŒ¨'}
```

#### 3ë‹¨ê³„: ì‹¤ì œ ì£¼ë¬¸ ì ‘ìˆ˜ â†’ ë°°ì†¡ â†’ ì™„ë£Œ
```sql
-- ê³ ê° PO ì ‘ìˆ˜ ì‹œ (ìƒíƒœëŠ” ê·¸ëŒ€ë¡œ order)
UPDATE sales_process 
SET customer_po_number = ?,
    notes = 'ê³ ê° PO ì ‘ìˆ˜ ì™„ë£Œ'
WHERE id = ?

-- ì£¼ë¬¸ì„œ ìƒì„± (ì‹¤ì œ ì£¼ë¬¸ ì²˜ë¦¬)
INSERT INTO orders (
    order_number,
    quotation_id,
    customer_id,
    subtotal,
    tax_amount,
    total_amount,
    status               -- 'pending'
) VALUES (...)

-- ë°°ì†¡ ì‹œì‘
UPDATE sales_process 
SET process_status = 'delivery',
    actual_delivery_date = ?
WHERE id = ?

-- ì™„ë£Œ (ì‹¤ì œ ìˆ˜ì… í™•ì •)
UPDATE sales_process 
SET process_status = 'completed'
WHERE id = ?
```

### í˜„ê¸ˆ íë¦„ ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

### ì˜ì—… í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬ê±° (í˜„ê¸ˆ íë¦„ ì¤‘ì‹¬)
```python
def on_quotation_approval_for_cashflow(quotation_id, save_func, load_func):
    """ê²¬ì ì„œ ìŠ¹ì¸ ì‹œ í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ì„ ìœ„í•œ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒì„±"""
    
    quotation = get_quotation_by_id(quotation_id, load_func)
    
    # ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒì„± (í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ìš©)
    sales_process_data = {
        'process_number': generate_process_number(),
        'quotation_id': quotation_id,
        'customer_name': quotation.get('customer_name'),
        'customer_company': quotation.get('company'),
        'sales_rep_id': quotation.get('sales_rep_id'),
        'process_status': 'order',  # ì£¼ë¬¸ ì˜ˆì • ìƒíƒœë¡œ ì‹œì‘
        'item_description': quotation.get('item_name'),
        'quantity': quotation.get('quantity'),
        'unit_price': quotation.get('unit_price'),
        'total_amount': quotation.get('total_amount'),  # ì˜ˆìƒ ìˆ˜ì…
        'currency': quotation.get('currency'),
        'expected_delivery_date': quotation.get('delivery_date'),  # ì˜ˆìƒ ìˆ˜ì… ì‹œê¸°
        'payment_terms': quotation.get('payment_terms'),
        'profit_margin': calculate_margin_from_quotation(quotation)  # ì˜ˆìƒ ë§ˆì§„
    }
    
    # í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ ì‹œì‘
    return save_func("sales_process", sales_process_data)
```

### ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì¡°íšŒ íŒ¨í„´

#### ì „ì²´ ì˜ì—… í˜„í™© ì¡°íšŒ
```python
def get_sales_process_overview(load_func):
    """ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì „ì²´ í˜„í™©"""
    sales_processes = load_func("sales_process")
    
    # ë‹¨ê³„ë³„ ì§‘ê³„
    status_counts = {}
    for process in sales_processes:
        status = process.get('process_status', 'unknown')
        status_counts[status] = status_counts.get(status, 0) + 1
    
    return status_counts

# ê²°ê³¼ ì˜ˆì‹œ
# {
#   'quotation': 15,
#   'negotiation': 8,
#   'contract': 3,
#   'order': 12,
#   'delivery': 5,
#   'completed': 45
# }
```

#### ì˜ì—… ë‹´ë‹¹ìë³„ í˜„í™©
```python
def get_sales_by_rep(sales_rep_id, load_func):
    """ì˜ì—… ë‹´ë‹¹ìë³„ í”„ë¡œì„¸ìŠ¤ í˜„í™©"""
    sales_processes = load_func("sales_process")
    rep_processes = [p for p in sales_processes if p.get('sales_rep_id') == sales_rep_id]
    
    # ê¸ˆì•¡ ì§‘ê³„
    total_amount = sum(p.get('total_amount', 0) for p in rep_processes)
    
    return {
        'total_processes': len(rep_processes),
        'total_amount': total_amount,
        'processes_by_status': group_by_status(rep_processes)
    }
```

#### ì˜ì—… ì´ë ¥ ì¶”ì 
```python
def get_process_history(process_id, load_func):
    """íŠ¹ì • ì˜ì—… í”„ë¡œì„¸ìŠ¤ì˜ ì „ì²´ ì´ë ¥"""
    history = load_func("sales_process_history")
    process_history = [h for h in history if h.get('sales_process_id') == process_id]
    
    # ì‹œê°„ ìˆœ ì •ë ¬
    process_history.sort(key=lambda x: x.get('change_date', ''))
    
    return process_history
```

### ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒíƒœ ê´€ë¦¬ (í˜„ê¸ˆ íë¦„ ì¤‘ì‹¬)

#### ìƒíƒœ ì „í™˜ ê·œì¹™ (ê²¬ì ì„œ ìŠ¹ì¸ í›„ orderë¶€í„° ì‹œì‘)
```python
VALID_STATUS_TRANSITIONS = {
    # ê²¬ì ì„œ ìŠ¹ì¸ í›„ ì£¼ë¬¸ë¶€í„° ì‹œì‘ (í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ ì¦‰ì‹œ ì‹œì‘)
    'order': ['delivery', 'cancelled'],       # ì£¼ë¬¸ â†’ ë°°ì†¡ or ì·¨ì†Œ
    'delivery': ['completed', 'order'],       # ë°°ì†¡ â†’ ì™„ë£Œ or ì£¼ë¬¸(ë°˜í’ˆ)
    'completed': [],                          # ìµœì¢… ìƒíƒœ (ì‹¤ì œ ìˆ˜ì… í™•ì •)
    'cancelled': []                           # ì¢…ë£Œ ìƒíƒœ
}

def validate_status_change(current_status, new_status):
    """ìƒíƒœ ì „í™˜ ìœ íš¨ì„± ê²€ì¦"""
    valid_transitions = VALID_STATUS_TRANSITIONS.get(current_status, [])
    return new_status in valid_transitions
```

#### ê²¬ì ì„œ ìŠ¹ì¸ ì‹œ í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ ì‹œì‘
```python
def handle_quotation_approval_for_cashflow(quotation_id, approver_id, update_func, save_func, load_func):
    """ê²¬ì ì„œ ìŠ¹ì¸ ì‹œ í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ì„ ìœ„í•œ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì¦‰ì‹œ ì‹œì‘"""
    
    # 1. ê²¬ì ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸
    quotation_update = {
        'id': quotation_id,
        'status': 'ìŠ¹ì¸ë¨',
        'updated_at': datetime.now().isoformat()
    }
    update_func("quotations", quotation_update)
    
    # 2. ì˜ì—… í”„ë¡œì„¸ìŠ¤ ì¦‰ì‹œ ìƒì„± (í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ìš©)
    success = on_quotation_approval_for_cashflow(quotation_id, save_func, load_func)
    
    if success:
        # 3. í˜„ê¸ˆ íë¦„ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
        return {
            'success': True,
            'message': 'ê²¬ì ì„œ ìŠ¹ì¸ì™„ë£Œ! í˜„ê¸ˆ íë¦„ ì˜ˆì¸¡ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.',
            'cash_flow_impact': {
                'expected_income': get_expected_income_from_quotation(quotation_id, load_func),
                'expected_month': get_expected_delivery_month(quotation_id, load_func)
            }
        }
    
    return {'success': False, 'message': 'ì˜ì—… í”„ë¡œì„¸ìŠ¤ ìƒì„± ì‹¤íŒ¨'}
```

#### ìë™ ìƒíƒœ ë™ê¸°í™”
```python
def sync_process_status(process_id, update_func, load_func):
    """ê²¬ì ì„œ/ì£¼ë¬¸ì„œ ìƒíƒœì™€ ì˜ì—… í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”"""
    process = get_sales_process_by_id(process_id, load_func)
    
    # ê²¬ì ì„œ ìƒíƒœ í™•ì¸
    if process.get('quotation_id'):
        quotation = get_quotation_by_id(process['quotation_id'], load_func)
        if quotation.get('status') == 'ìŠ¹ì¸ë¨' and process.get('process_status') == 'negotiation':
            update_process_status(process_id, 'contract', update_func)
    
    # ì£¼ë¬¸ì„œ ìƒíƒœ í™•ì¸
    if process.get('order_id'):
        order = get_order_by_id(process['order_id'], load_func)
        if order.get('status') == 'delivered' and process.get('process_status') == 'delivery':
            update_process_status(process_id, 'completed', update_func)
```

---

## ğŸ¨ ì£¼ìš” ê¸°ëŠ¥ë³„ ê°œë°œ ê°€ì´ë“œ

### 1. ê²¬ì ì„œ ê´€ë¦¬ (quotations)
**í•µì‹¬ ê¸°ëŠ¥:**
- ì‹¤ì‹œê°„ ê³ ê°/ì œí’ˆ ì„ íƒ ì—°ë™
- VND ê¸°ì¤€ ê°€ê²© ê³„ì‚° (í™˜ìœ¨ ì ìš©)
- ì œí’ˆ ì›ê°€ ì—°ë™ ë§ˆì§„ ê³„ì‚°
- HTML ì¶œë ¥ (ì¸ì‡„ìš©)

**ì¤‘ìš” ê°œë°œ í¬ì¸íŠ¸:**
```python
# ì œí’ˆ ì„ íƒ ì‹œ ì›ê°€ ì •ë³´ ë¡œë“œ
selected_product = get_product_by_id(product_id)
cost_price_usd = selected_product.get('cost_price_usd', 0)  # ì •í™•í•œ ì»¬ëŸ¼ëª…

# VND ë³€í™˜
exchange_rate = 24000  # ê¸°ë³¸ê°’
unit_price_vnd = unit_price_usd * exchange_rate

# ë§ˆì§„ ê³„ì‚°
margin_rate = calculate_margin(unit_price_usd, cost_price_usd)
```

### 2. ì œí’ˆ ê´€ë¦¬ (products)
**í•µì‹¬ ê¸°ëŠ¥:**
- USD ì›ê°€/íŒë§¤ê°€ ê´€ë¦¬
- VND íŒë§¤ê°€ ìë™ ê³„ì‚°
- ë‹¤êµ­ì–´ ì œí’ˆëª… ì§€ì›
- ì¬ê³  ê´€ë¦¬

**ì¤‘ìš” ê°œë°œ í¬ì¸íŠ¸:**
```python
# ì œí’ˆ ë“±ë¡ ì‹œ ì •í™•í•œ ì»¬ëŸ¼ ë§¤í•‘
product_data = {
    'product_name': product_name_en,        # ê¸°ë³¸ëª…
    'product_name_en': product_name_en,     # ì˜ë¬¸ëª…
    'product_name_vn': product_name_vn,     # ë² íŠ¸ë‚¨ì–´ëª…
    'cost_price_usd': cost_price_usd,       # USD ì›ê°€
    'selling_price_usd': selling_price_usd, # USD íŒë§¤ê°€
    'unit_price_vnd': unit_price_vnd,       # VND íŒë§¤ê°€
    'is_active': True,                      # Boolean ìƒíƒœ
}
```

### 3. ê³ ê° ê´€ë¦¬ (customers)
**í•µì‹¬ ê¸°ëŠ¥:**
- KAM ì •ë³´ ê´€ë¦¬
- ì‚¬ì—…ì ì •ë³´ ê´€ë¦¬
- ê²¬ì ì„œ ì—°ê²° í™•ì¸
- CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ

### 4. ì§€ì¶œ ê´€ë¦¬ (expenses)
**í•µì‹¬ ê¸°ëŠ¥:**
- ë‹¤ì¤‘ í†µí™” ì§€ì›
- ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°
- ì¶œë ¥ ì–‘ì‹ ìƒì„±

---

## ğŸš¨ í˜„ì¬ ë¬¸ì œ ë° í•´ê²° ë°©ì•ˆ

### 1. ê²¬ì ì„œ-ì œí’ˆ ì›ê°€ ì—°ë™ ë¬¸ì œ (Critical)
**ë¬¸ì œ:** quotations í…Œì´ë¸”ì— ì›ê°€ ì»¬ëŸ¼ ì—†ìŒ
**í•´ê²°:** products í…Œì´ë¸”ì˜ cost_price_usd ì¡°íšŒ

```python
# âŒ ì˜ëª»ëœ ë°©ë²•
cost_price = quotation_data.get('cost_price', 0)

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•  
product_id = quotation_data.get('product_id')
products = load_func("products")
product = next((p for p in products if p['id'] == product_id), None)
cost_price_usd = product.get('cost_price_usd', 0) if product else 0
```

### 2. ì»¬ëŸ¼ëª… ë¶ˆì¼ì¹˜ ë¬¸ì œ
**ì£¼ì˜ì‚¬í•­:**
- `cost_price` (X) â†’ `cost_price_usd` (O)
- `selling_price` (X) â†’ `selling_price_usd` (O)
- `unit_price_vnd` (O) - ì •í™•í•¨

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ ìš°ì„ ìˆœìœ„

### ì¦‰ì‹œ í•´ê²° (Critical)
1. **ê²¬ì ì„œ ì›ê°€ ì—°ë™ ìˆ˜ì •**: cost_price â†’ cost_price_usd
2. **ë§ˆì§„ ê³„ì‚° ë¡œì§ ìˆ˜ì •**: ì œí’ˆ í…Œì´ë¸” ì¡°íšŒ ë°©ì‹ ë³€ê²½

### ë‹¨ê¸° ê°œì„  (High)  
3. **ì œí’ˆ ê´€ë¦¬ ê³ ë„í™”**: CSV ì—…ë¡œë“œ, ì¬ê³  ê´€ë¦¬
4. **ê²¬ì ì„œ ì›Œí¬í”Œë¡œìš°**: ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤, ë¦¬ë¹„ì „ ê´€ë¦¬

### ì¤‘ê¸° ê°œë°œ (Medium)
5. **í†µí•© ëŒ€ì‹œë³´ë“œ**: ê²¬ì -ê³ ê°-ì œí’ˆ ì—°ë™ í†µê³„
6. **ê³ ê¸‰ ê¸°ëŠ¥**: ìë™ ê²¬ì ë²ˆí˜¸, ì´ë©”ì¼ ë°œì†¡

---

## ğŸ’¾ ë°±ì—… ë° ì—°ì†ì„± ê´€ë¦¬

### ë°±ì—… íŒŒì¼ ìƒì„± (ê·œì¹™ 10)
ë§¤ ê°œë°œ ì„¸ì…˜ ì¢…ë£Œ ì‹œ ë‹¤ìŒ ì •ë³´ í¬í•¨:
- ì‹œìŠ¤í…œ í˜„í™© ë° ì™„ì„±ë„
- í•¨ìˆ˜ ë¦¬ìŠ¤íŠ¸ ë° í˜¸ì¶œ ê´€ê³„
- ì‹¤ì œ DB ìŠ¤í‚¤ë§ˆ ì •ë³´
- ì§„í–‰ ì‚¬í•­ ë° ë‹¤ìŒ ë‹¨ê³„
- í˜„ì¬ ë¬¸ì œì  ë° í•´ê²° ë°©ì•ˆ

### ìƒˆ ì±„íŒ…ì—ì„œ ê°œë°œ ì¬ê°œ
1. ìµœì‹  ê·œì¹™ íŒŒì¼ (V10) ì—…ë¡œë“œ
2. ë°±ì—… íŒŒì¼ ì—…ë¡œë“œ  
3. "ê·œì¹™ V10 + ì´ ë°±ì—… ê¸°ì¤€ìœ¼ë¡œ ê°œë°œ ê³„ì†í•´ì¤˜"

---

## ğŸ” ê°œë°œ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### DB ê´€ë ¨ ì‘ì—… ì „
- [ ] ì‹¤ì œ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
- [ ] ì»¬ëŸ¼ëª… ì •í™•íˆ ë§¤í•‘
- [ ] ë°ì´í„° íƒ€ì… í™•ì¸
- [ ] FK ê´€ê³„ í™•ì¸

### ì½”ë”© ì „
- [ ] ìˆ˜ì • ë‚´ìš© ì„¤ëª…
- [ ] ì‚¬ìš©ì ìŠ¹ì¸ ë°›ê¸°
- [ ] ì „ì²´ íŒŒì¼ ë‹¨ìœ„ë¡œ ì‘ì„±
- [ ] Import ìˆœì„œ ì¤€ìˆ˜

### ì™„ë£Œ í›„
- [ ] ë™ì‘ í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í™•ì¸
- [ ] ë°±ì—… íŒŒì¼ ì—…ë°ì´íŠ¸

---

## ğŸ¯ ìµœì¢… ëª©í‘œ

**ì™„ì „í•œ ERP ì‹œìŠ¤í…œ êµ¬ì¶•**
- ê²¬ì ì„œ-ê³ ê°-ì œí’ˆ ì™„ì „ ì—°ë™
- ì‹¤ì‹œê°„ ë§ˆì§„ ê³„ì‚° ë° ë¶„ì„
- ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´, ì˜ì–´, ë² íŠ¸ë‚¨ì–´)
- ì¸ì‡„/ì¶œë ¥ ìµœì í™”
- CSV ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ
- ê¶Œí•œ ê¸°ë°˜ ì‚¬ìš©ì ê´€ë¦¬

**í˜„ì¬ ìƒíƒœ: 95% ì™„ì„±**
- ë‚¨ì€ ì‘ì—…: ê²¬ì ì„œ ì›ê°€ ì—°ë™ 1ê°œ ì´ìŠˆ
- ì˜ˆìƒ ì™„ë£Œ ì‹œê°„: 10ë¶„

---

## ğŸ“š ì¶”ê°€ ì°¸ê³ ì‚¬í•­

### Supabase íŠ¹í™” ê³ ë ¤ì‚¬í•­
- Row Level Security (RLS) ì„¤ì •
- Realtime ê¸°ëŠ¥ í™œìš© ê°€ëŠ¥
- PostgreSQL í•¨ìˆ˜ í™œìš©
- ìë™ API ìƒì„± í™œìš©

### ì„±ëŠ¥ ìµœì í™”
- ì¿¼ë¦¬ ìµœì í™” (í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ)
- ì¸ë±ìŠ¤ í™œìš©
- ìºì‹± ì „ëµ
- í˜ì´ì§€ë„¤ì´ì…˜

ì´ ê°€ì´ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œìš´ ì±„íŒ…ì—ì„œë„ ì¼ê´€ëœ í’ˆì§ˆì˜ ê°œë°œì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.