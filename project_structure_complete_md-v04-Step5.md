# YMV Business System - 프로젝트 상태 문서 v4.0-Step5

## 📋 프로젝트 개요

**프로젝트명**: YMV 관리 프로그램  
**위치**: D:\ymv-business-system  
**개발 언어**: Python + Streamlit  
**데이터베이스**: Supabase PostgreSQL  
**GitHub**: https://github.com/dajungeks/ymv-business-system.git  
**배포 URL**: https://ymv-business-system.streamlit.app  
**현재 버전**: v4.0-Step5 (지출 요청서 CEO 승인 워크플로우 완료)

## 🎯 개발 목표

베트남 소재 한국 기업을 위한 통합 비즈니스 관리 시스템

### ✅ 완료된 단계 (Step 1-5)
- ✅ 로컬 JSON 기반 시스템 구축 (v1.0)
- ✅ 전체 기능 완성 및 고도화 (v2.0)
- ✅ Supabase 클라우드 DB 연결 + 배포 (v3.0)
- ✅ **데이터베이스 스키마 수정 완료** (Step 1)
- ✅ **Widget 중복 오류 수정** (Step 2-3)
- ✅ **메뉴 네비게이션 수정** (Step 4)
- ✅ **지출 요청서 완전 기능 구현** (Step 5)

### 🔄 다음 단계 (Step 6-8)
- ❌ 제품-코드 연동 로직 구현 (Step 6)
- ❌ 견적서 다국어 연동 완성 (Step 7)
- ❌ CRUD 수정 기능 복구 (고객/직원 관리) (Step 8)

## 🗂️ 현재 프로젝트 구조

```
D:\ymv-business-system/
├── .env                                    # 환경 변수 (Supabase 연결 정보)
├── .env.example                           # 환경 변수 예시
├── requirements.txt                        # Python 의존성
├── .streamlit/
│   └── config.toml                        # Streamlit 설정
├── database/
│   ├── init_db.sql                        # 초기 DB 스키마
│   ├── upgrade_v4.sql                     # v4.0 업그레이드 스키마
│   └── ✅ additional_schema_fix.sql       # Step 5-1 추가 스키마 (완료)
├── README.md                              # 프로젝트 문서
├── .gitignore                             # Git 제외 파일
├── app/
│   ├── ✅ main.py                         # 메인 애플리케이션 (Step 5 완료)
│   ├── components/                        # 컴포넌트 모듈 (Step 3 완료)
│   │   ├── ✅ __init__.py                 # 패키지 초기화 (완료)
│   │   ├── ✅ code_management.py          # 코드 관리 컴포넌트 (완료)
│   │   └── ✅ multilingual_input.py       # 다국어 입력 컴포넌트 (완료)
│   └── __init__.py                        # 초기화 파일
├── data/                                  # JSON 백업 (마이그레이션 완료)
├── uploads/                               # 업로드 파일
├── exports/                               # 내보내기 파일
├── logs/                                  # 로그 파일
└── fonts/                                 # 폰트 파일
```

## 🌐 클라우드 인프라 구성 (현재 상태)

### 🔗 Supabase 데이터베이스
- **프로젝트 URL**: https://eqplgrbegwzeynnbcuep.supabase.co
- **데이터베이스**: PostgreSQL 15
- **지역**: Asia Pacific (ap-southeast-1)
- **상태**: 활성 운영 중 ✅
- **Step 5 스키마 업데이트**: 완료 ✅

### 🚀 Streamlit Cloud 배포
- **배포 URL**: https://ymv-business-system.streamlit.app
- **GitHub 연동**: 자동 배포 활성화
- **환경 변수**: 보안 설정 완료
- **상태**: 실시간 운영 중 ✅

## 💻 Step 5까지 완성된 기능들

### 🔐 인증 시스템 (완전 구현)
- **클라우드 인증**: Supabase 기반 사용자 관리
- **다중 사용자 로그인**: 직원별 개별 계정
- **권한 관리**: 관리자/일반 사용자 구분 (CEO 승인용)
- **세션 관리**: 안전한 클라우드 세션
- **기본 관리자 계정**: Master / 1023

### 📊 대시보드 (Step 5 업데이트)
- **실시간 통계**: Supabase 실시간 데이터
- **제품 코드 개수**: v4.0 기능 표시
- **✅ CEO 승인 대기 알림**: 관리자용 알림 추가
- **사용자별 맞춤 정보**: 로그인 사용자 기준
- **최근 활동**: 구매품/견적서 최신 데이터
- **빠른 통계**: 사이드바 실시간 요약

### 📦 구매품 관리 (기존 유지)
- 카테고리별 구매품 등록
- 상태 관리 및 추적
- CSV 다운로드 (한글 깨짐 해결)
- 기본적인 CRUD 기능

### ✅ 💰 지출 요청서 관리 (Step 5 완전 구현)
**CEO 승인 워크플로우 (4단계)**
- **1단계**: 직원 요청 (대기중)
- **2단계**: CEO 승인 대기 (CEO승인대기)  
- **3단계**: CEO 승인 완료 (승인됨)
- **4단계**: 지급 완료 (지급완료)
- **5단계**: 인보이스 확인 완료 (인보이스 확인완료)
- **반려 처리**: CEO 반려 (반려됨)

**4개 탭 구성**
- ✅ **지출 요청서 작성**: 권한별 상태 선택 제한
- ✅ **지출 요청서 목록**: 월단위 상세 정보 + 완전한 CRUD
- ✅ **비용 통계**: 승인 워크플로우 현황 포함
- ✅ **CEO 승인**: 관리자 전용 승인/반려 관리

**프린트 기능**
- ✅ **공식 지출 요청서 양식**: CEO 승인란 포함
- ✅ **브라우저 프린트 지원**: CSS @media print 최적화
- ✅ **승인용 출력**: CEO 승인 시 사용

**완전한 기능**
- ✅ **생성**: 지출 요청서 작성 (권한별 제한)
- ✅ **읽기**: 월단위 그룹핑 + 엑셀 형태 테이블 표시
- ✅ **수정**: 모든 필드 인라인 수정 (권한별 제한)
- ✅ **삭제**: 즉시 삭제 기능
- ✅ **프린트**: 공식 양식 출력
- ✅ **CSV 다운로드**: 한글 깨짐 완전 해결 (BOM 포함)
- ✅ **승인 관리**: CEO 전용 승인/반려 처리

### 📋 견적서 관리 (부분 구현 - Step 7 예정)
- 기본 견적서 구조 존재
- 다국어 연동은 Step 7에서 구현 예정

### 👥 고객 관리 (부분 구현 - Step 8 예정)
- 기본 고객 데이터 구조 존재
- CRUD 수정 기능은 Step 8에서 복구 예정

### 📦 제품 관리 (부분 구현 - Step 6 예정)
- 다국어 제품명 구조 존재
- 코드 연동 로직은 Step 6에서 구현 예정

### 👨‍💼 직원 관리 (부분 구현 - Step 8 예정)
- 기본 직원 데이터 구조 존재
- CRUD 수정 기능은 Step 8에서 복구 예정

### ✅ ⚙️ 시스템 관리 (Step 3 완성)
**회사 정보 관리**
- 기본 정보: 회사명, 주소, 연락처
- 사업 정보: 사업자등록번호, 대표자명, 업종
- 클라우드 저장: 실시간 동기화

**환율 관리**
- 환율 등록: 기준통화/대상통화/환율/적용일
- 환율 목록: 등록된 모든 환율 조회
- CSV 관리: 환율 데이터 다운로드

**✅ 코드 관리 (Step 3 완성)**
- **코드 체계 등록**: 7단계 코드 구성 (CODE01~CODE07)
- **카테고리 관리**: 제품 카테고리 체계 구축
- **코드 형식**: `HR-01-02-03-ST-KR-00` (하이픈 구분)
- **실시간 미리보기**: 코드 입력 시 즉시 확인
- **수정/삭제**: 기존 코드 관리
- **활성/비활성**: 코드 상태 관리
- **CSV 관리**: 코드 데이터 업로드/다운로드

## 🗄️ Supabase 데이터베이스 구조 (Step 5 최종)

### 📊 테이블 구성 (9개 테이블 + 추가 컬럼)
1. **employees** - 직원 정보 및 인증
2. **company_info** - 회사 기본 정보 (✅ business_number 컬럼 추가)
3. **exchange_rates** - 환율 관리
4. **customers** - 고객 정보 (✅ business_type 컬럼 추가)
5. **products** - 제품 정보 (다국어 컬럼 존재, 연동 대기)
6. **purchases** - 구매품 관리
7. **✅ expenses** - 지출 요청서 (Step 5 완전 확장)
   - ✅ vendor VARCHAR(200) - 거래처
   - ✅ expense_type VARCHAR(100) - 지출 유형
   - ✅ expense_date DATE - 지출일
   - ✅ payment_method VARCHAR(100) - 결제 방법
   - ✅ currency VARCHAR(10) - 통화
   - ✅ purpose TEXT - 사업 목적 (기존)
8. **quotations** - 견적서 관리 (다국어 연동 대기)
9. **product_codes** - 제품 코드 관리 (완성)

### 🔗 관계 설정 (Step 5 현재)
- **purchases.requester** → **employees.id**
- **✅ expenses.requester** → **employees.id** (완전 활용)
- **quotations.created_by** → **employees.id**
- **quotations.customer_id** → **customers.id**
- **exchange_rates.created_by** → **employees.id**
- **products.code_category** → **product_codes.category** (연동 대기)
- **product_codes.created_by** → **employees.id**

## 🎨 Step 5 UI/UX 완성 상태

### ✅ 지출 요청서 관리 페이지 (완전 구현)
```
💰 지출 요청서 관리
├── 📝 지출 요청서 작성 (권한별 상태 제한)
├── 📋 지출 요청서 목록 (월단위 + 완전한 CRUD)
├── 📊 비용 통계 (승인 워크플로우 현황)
└── 👔 CEO 승인 (관리자 전용 승인 관리)
```

### ✅ 메뉴 네비게이션 (Step 4 완성)
- **버튼 기반 메뉴**: selectbox → button 방식으로 변경
- **세션 상태 관리**: current_menu 상태 관리
- **즉시 반영**: 메뉴 클릭 시 페이지 즉시 변경
- **CEO 승인 알림**: 사이드바에 대기 건수 표시

### ⚙️ 시스템 관리 페이지 (Step 3 완성)
```
⚙️ 시스템 관리
├── 🏢 회사 정보
├── 💱 환율 관리  
└── ✅ 🏷️ 코드 관리 (완전 구현)
    ├── 📝 코드 등록 (7단계 실시간 미리보기)
    └── 📋 코드 목록 (수정/삭제/상태변경)
```

## 🔧 Step 5에서 해결된 문제들

### ✅ 1. 데이터베이스 스키마 불일치 (Step 1, 5-1)
- **expenses 테이블**: purpose, vendor, expense_type, expense_date, payment_method, currency 컬럼 추가 ✅
- **customers 테이블**: business_type 컬럼 추가 ✅
- **company_info 테이블**: business_number 컬럼 추가 ✅

### ✅ 2. Widget 중복 오류 (Step 2-3)
- **고유 키 생성**: timestamp + UUID 방식으로 완전 해결 ✅
- **컴포넌트 모듈화**: 재사용 가능한 컴포넌트 구조 완성 ✅

### ✅ 3. 메뉴 네비게이션 (Step 4)
- **selectbox → button**: 즉시 반영되는 메뉴 시스템 ✅
- **세션 상태 관리**: 안정적인 메뉴 상태 유지 ✅

### ✅ 4. 지출 요청서 완전 기능 (Step 5)
- **월단위 표시**: 접이식 월별 그룹핑 완성 ✅
- **CSV 한글 깨짐**: BOM 포함으로 완전 해결 ✅
- **완전한 CRUD**: 생성/읽기/수정/삭제 모두 구현 ✅
- **CEO 승인 워크플로우**: 4단계 승인 프로세스 완성 ✅
- **프린트 기능**: 공식 양식 출력 기능 완성 ✅

## 📋 다음 단계 작업 계획 (Step 6-8)

### Step 6: 제품-코드 연동 로직 구현
- **제품 등록 개선**: 카테고리 선택 → 코드 드롭다운
- **제품-코드 매핑**: product_codes와 products 테이블 완전 연동
- **다국어 제품명 활용**: 영어/베트남어 제품명 시스템 활성화

### Step 7: 견적서 다국어 연동 완성  
- **견적서-제품 연동**: 다국어 제품명 자동 표시
- **언어별 견적서**: 고객 언어에 맞는 견적서 생성
- **견적서 CRUD**: 완전한 견적서 관리 기능

### Step 8: CRUD 수정 기능 복구
- **고객 관리**: 수정/삭제 기능 복구
- **직원 관리**: 수정/삭제 기능 복구  
- **환율 관리**: 엑셀 형태 표시 + 수정/삭제 개선

## 🚀 현재 접근 방법

### 🌐 웹 접근
- **배포 URL**: https://ymv-business-system.streamlit.app
- **지원 기기**: PC, 태블릿, 스마트폰
- **브라우저**: Chrome, Firefox, Safari, Edge

### 🔐 로그인 정보
- **기본 관리자**: Master / 1023
- **권한**: 관리자 (CEO 승인 기능 사용 가능)
- **추가 사용자**: 직원 관리에서 등록

### 💻 로컬 개발 환경
```bash
# 로컬 실행
cd D:\ymv-business-system
streamlit run app\main.py
# 접속: http://localhost:8501
```

## 🎯 Step 5 완성도

### ✅ 완성된 기능 (100%)
- **지출 요청서 작성**: 권한별 상태 제한 ✅
- **지출 요청서 목록**: 월단위 + CRUD ✅
- **비용 통계**: 승인 워크플로우 현황 ✅
- **CEO 승인**: 승인/반려 관리 ✅
- **프린트**: 공식 양식 출력 ✅
- **CSV 다운로드**: 한글 깨짐 해결 ✅

### 🔄 다음 단계 준비
- **제품 코드 시스템**: 연동 로직 구현 대기
- **견적서 다국어**: 제품 연동 후 활성화 예정
- **고객/직원 CRUD**: 수정 기능 복구 예정

## 📞 지원 및 문의

### 현재 상태
- **Step 1-5**: 완료 ✅
- **데이터베이스**: 25건 지출 요청서 데이터 보유
- **핵심 기능**: 지출 요청서 CEO 승인 워크플로우 완전 작동
- **다음 작업**: Step 6 (제품-코드 연동) 진행 예정

### 기술 지원
- **GitHub Repository**: https://github.com/dajungeks/ymv-business-system.git
- **실시간 운영**: https://ymv-business-system.streamlit.app

---

## 🏆 Step 5 성과 요약

### ✅ 기술적 성과
- **CEO 승인 워크플로우**: 4단계 승인 시스템 완성
- **프린트 기능**: CSS @media print 최적화 완료
- **데이터베이스 안정성**: 모든 스키마 오류 해결
- **사용자 경험**: 월단위 표시 + 완전한 CRUD

### ✅ 비즈니스 성과
- **승인 프로세스**: 체계적인 지출 승인 시스템
- **권한 관리**: CEO/일반직원 명확한 역할 구분
- **문서화**: 프린트 가능한 공식 양식 제공
- **현지화**: 베트남 기업 운영에 최적화

### ✅ 다음 채팅창 연계
이 문서를 다음 채팅창에서 사용하여 Step 6부터 진행할 수 있습니다.

**마지막 업데이트**: 2025-09-23 Step 5 완료  
**다음 작업**: Step 6 - 제품-코드 연동 로직 구현  
**완성도**: 지출 요청서 관리 100% 완료